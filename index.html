<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Collision-map-maker</title>
</head>

<body>
    <div id = "control_buttons" 
        style = "position: fixed; right: 0; top: 50; z-index: 1000; display: flex; flex-direction: column; border: 2px solid red;"
        >
        <input type="file" onchange='loadFront(event)'/>
    
        <label for="opacity">Opacity:</label>
        <input type="range" min="0" max="100" value="1" onchange="changeBackOpacity(event)" step="10"
            name = 'opacity' id = 'opacity' style = "max-width: 150px;"
        >
        
    </div>

    <div id="container" style = "border: 2px solid red;">

    </div>
    
</body>
    <script src="https://unpkg.com/konva@8/konva.min.js"></script>
    <script>
        let stage = null, layer = null, front = null, back = null

        function loadFront (e) {
            const input = e.target
            if (!input.files.length) return

            const reader = new FileReader()

            reader.onload = () => {
                const dataURL = reader.result
                initStage(dataURL)
            }

            reader.readAsDataURL(input.files[0])
        }

        function initStage (dataURL) {
            stage = new Konva.Stage({
                container: 'container',
                width: window.innerWidth,
                height: window.innerHeight,
            })
        
            layer = new Konva.Layer()
            stage.add(layer)

            setFrontImage(dataURL)
        }

        function setFrontImage (dataURL) {
            const image = new Image()
            image.onload = () => {
                front = new Konva.Image({ image })
                layer.add(front)

                stage.setAttrs({width: image.width, height: image.height})
                setBackImage()
            }
            image.src = dataURL
        }

        function setBackImage () {
            const image = new Image()
            image.onload = () => {
                back = new Konva.Image({ image, width: front.width(), height: front.height(), opacity: 0 })
                layer.add(back)
            }
            image.src = 'public/white.png'
        }

        function changeBackOpacity (e) {
            console.log(e.target.value / 100)
            if (back) back.setAttr('opacity', e.target.value / 100)
        }
        
      </script>
</html>